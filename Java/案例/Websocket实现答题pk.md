https://juejin.cn/post/7344567644174106659

### 技术细节：

状态同步：在对战中，通过WebSocket实时同步玩家的操作和游戏状态，每个动作都通过服务器广播给所有参与者，确保了游戏进程的同步性和准确性。

- **异常处理与稳定性：** 对于WebSocket连接。一旦检测到游戏中的某一方异常断开，系统会自动结算对局。
    
- **用户状态设置：** 用户的状态可粗略分为匹配中，对局中等，不同的状态
    
- **用户匹配机制：** 项目中的匹配系统采用动态队列，遵循先来后到，并可以根据用户的段位等信息进行分开匹配，一定程度上提升用户体验。
    
- **并发错误避免：** 在项目中，每一次对局的双方用户的状态信息都将保存在一个hashmap当中，实现一个房间的机制，标记用户的状态为游戏中，防止第三用户加入对局，引发未知错误。

### 实现过程：

整个对战大致可以分为三个部分：对战前，对战中，对战后。

- **对战前：** 匹配对手，匹配成功后，服务器获取双方的个人信息，以及单次对局中的题目列表，发送到双方的客户端中。
    
- **对战中：** 双方用户答题，提交答案后。客户端将答题信息发送到服务器中，服务器将其广播到对方客户端中。刷新双方分数信息。之后的每一次答题均重复其过程。
    
- **对战后：** 答题完毕，刷新用户为结算状态。服务器根据双方得分情况判断胜负，广播到双方客户端中。